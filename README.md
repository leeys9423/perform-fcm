# í‘¸ì‹œ ì•Œë¦¼ ì„œë¹„ìŠ¤ ê°œì„ 

## ğŸ“‹ í”„ë¡œì íŠ¸ ë°°ê²½
### ê¸°ì¡´ ì„œë¹„ìŠ¤ì˜ ë¬¸ì œì 

1. ì¶œê²° ì²˜ë¦¬ ì‹œ í•™ë¶€ëª¨ ëŒ€ìƒ í‘¸ì‹œ ì•Œë¦¼ ë¯¸ì „ì†¡ ë¬¸ì œ ë°œìƒ
    - ìµœëŒ€ ë™ì‹œ ìš”ì²­ 200~300ëª… ìƒí™©ì—ì„œ ê°„í—ì  ì‹¤íŒ¨
2. ë¡œê¹… ì‹œìŠ¤í…œ ë¶€ì¬ë¡œ ì¸í•œ ì›ì¸ íŒŒì•… ë¶ˆê°€
    - í”„ë¡œê·¸ë¨ ìì²´ ì˜¤ë¥˜ì¸ì§€ Firebase ë¬¸ì œì¸ì§€ êµ¬ë¶„ ë¶ˆê°€

### ë¬¸ì œ ì›ì¸ ë¶„ì„

1. Firebase ì„œë²„ ìƒíƒœì— ë”°ë¥¸ ë©”ì‹œì§€ ì „ì†¡ ì§€ì—°/ì‹¤íŒ¨
2. ëŒ€ëŸ‰ ë©”ì‹œì§€ ì „ì†¡ ì‹œ ì²˜ë¦¬ ì†ë„ ë° ì œí•œ ì‚¬í•­
3. ë””ë°”ì´ìŠ¤ í† í° ê´€ë¦¬ ë¬¸ì œ
    - ì£¼ê¸°ì  í† í° ê°±ì‹ ìœ¼ë¡œ ì¸í•œ ìµœì‹  í† í° ìœ ì§€ ì–´ë ¤ì›€
    - ì•± ì‚­ì œ/ì¬ì„¤ì¹˜ ì‹œ í† í° ì •ë¦¬ ë¯¸í¡
    
### ê°œì„  ëª©í‘œ

1. ì»¤ìŠ¤í…€ ë¡œê¹… ì‹œìŠ¤í…œ êµ¬ì¶•
2. Spring Batchë¥¼ í™œìš©í•œ ì²˜ë¦¬ ì†ë„ ê°œì„ 
3. ë©”ì‹œì§€ ì¬ì „ì†¡ ë¡œì§ êµ¬í˜„
4. ì „ì†¡ í˜„í™© ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ êµ¬ì¶•
5. íš¨ìœ¨ì ì¸ í† í° ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬ì¶•

## ğŸ“¤ ë©”ì‹œì§€ ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤

### 1. ì‹¤ì‹œê°„ í‘¸ì‹œ ë°œì†¡ í”„ë¡œì„¸ìŠ¤
```mermaid
flowchart LR
    A[ì¶œê²° ì²´í¬] --> B[ë©”ì‹œì§€ ìƒì„±]
    B --> C[Redis Queue ì €ì¥]
    C --> D[ì›Œì»¤ ì„œë¹„ìŠ¤]
    D --> E{FCM ë°œì†¡}
    E -->|ì„±ê³µ| F[ì´ë ¥ ì €ì¥]
    E -->|ì‹¤íŒ¨| G[ì‹¤íŒ¨ ë©”ì‹œì§€<br/>DB ì €ì¥]
```

__ì²˜ë¦¬ê³¼ì •__
1. ì¶œê²° ì²´í¬ ë°œìƒ
2. í‘¸ì‹œ ë©”ì‹œì§€ ìƒì„± ë° Redis Queueì— ì €ì¥
3. ì›Œì»¤ê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ë©”ì‹œì§€ ì²˜ë¦¬
4. ì„±ê³µ ì‹œ ì´ë ¥ í…Œì´ë¸”ì— ì €ì¥
5. ì‹¤íŒ¨ ì‹œ ì¬ì²˜ë¦¬ë¥¼ ìœ„í•´ DBì— ì €ì¥

### 2. ì‹¤íŒ¨ ë©”ì‹œì§€ ì¬ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤
```mermaid
flowchart LR
    A[ë°°ì¹˜ ì‘ì—…] --> B[ì‹¤íŒ¨ ë©”ì‹œì§€<br/>ì¡°íšŒ]
    B --> C[FCM ì¬ë°œì†¡]
    C -->|ì„±ê³µ| D[ì´ë ¥ ì €ì¥]
    C -->|ì‹¤íŒ¨| E[ì¬ì‹œë„ íšŸìˆ˜<br/>ì¦ê°€]
```

__ì²˜ë¦¬ê³¼ì •__
1. ì •í•´ì§„ ì£¼ê¸°ë¡œ ì‹¤íŒ¨ ë©”ì‹œì§€ ì¡°íšŒ
2. FCMìœ¼ë¡œ ì¬ë°œì†¡ ì‹œë„
3. ì„±ê³µ ì‹œ ì´ë ¥ ì €ì¥ ë° ì‹¤íŒ¨ ë©”ì‹œì§€ ì‚­ì œ
4. ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ íšŸìˆ˜ ì¦ê°€ (ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ê¹Œì§€)

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ
- Java 17
- Spring Boot 3.4
- Spring Data JPA
- Spring Batch
- Spring Data Redis
- Firebase Admin SDK
- MariaDB
- H2 Database (í…ŒìŠ¤íŠ¸ìš©)

## ğŸ“¦ í”„ë¡œì íŠ¸ êµ¬ì¡°
```
com.example.push
â”œâ”€â”€ domain                 # ë„ë©”ì¸ ê³„ì¸µ
â”‚   â”œâ”€â”€ device             # ë””ë°”ì´ìŠ¤ ê´€ë¦¬
â”‚   â”‚   â”œâ”€â”€ entity         # ì—”í‹°í‹°
â”‚   â”‚   â”œâ”€â”€ repository     # ì €ì¥ì†Œ
â”‚   â”‚   â”œâ”€â”€ service        # ì„œë¹„ìŠ¤
â”‚   â”‚   â”œâ”€â”€ controller     # ì»¨íŠ¸ë¡¤ëŸ¬
â”‚   â”‚   â””â”€â”€ exception      # ì˜ˆì™¸
â”‚   â”œâ”€â”€ message            # ë©”ì‹œì§€ ê´€ë¦¬
â”‚   â”‚   â”œâ”€â”€ entity
â”‚   â”‚   â”œâ”€â”€ repository
â”‚   â”‚   â”œâ”€â”€ service
â”‚   â”‚   â””â”€â”€ exception
â”‚   â””â”€â”€ batch              # ë°°ì¹˜ ì‘ì—…
â”‚       â”œâ”€â”€ job
â”‚       â””â”€â”€ step
â”œâ”€â”€ global                 # ê³µí†µ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ common             # ê³µí†µ í´ë˜ìŠ¤
â”‚   â”‚   â”œâ”€â”€ BaseEntity     # ê¸°ë³¸ ì—”í‹°í‹°
â”‚   â”‚   â””â”€â”€ BaseResponse   # ê¸°ë³¸ ì‘ë‹µ
â”‚   â”œâ”€â”€ config             # ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ BatchConfig    # ë°°ì¹˜ ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ JpaConfig      # JPA ì„¤ì •
â”‚   â”‚   â””â”€â”€ RedisConfig    # Redis ì„¤ì •
â”‚   â””â”€â”€ error              # ì˜¤ë¥˜ ì²˜ë¦¬
â”‚       â”œâ”€â”€ code           # ì—ëŸ¬ ì½”ë“œ
â”‚       â”œâ”€â”€ exception      # ì˜ˆì™¸ í´ë˜ìŠ¤
â”‚       â”œâ”€â”€ handler        # ì˜ˆì™¸ ì²˜ë¦¬ê¸°
â”‚       â””â”€â”€ response       # ì—ëŸ¬ ì‘ë‹µ
â””â”€â”€ infra                  # ì™¸ë¶€ ì¸í”„ë¼
    â””â”€â”€ fcm                # Firebase ì—°ë™
```

## ğŸ”§ ì£¼ìš” ê¸°ëŠ¥
1. í‘¸ì‹œ ë©”ì‹œì§€ ê´€ë¦¬
    - í† í° ê´€ë¦¬
    - ë°°ì¹˜ ì²˜ë¦¬ë¥¼ í†µí•œ ë©”ì‹œì§€ ë°œì†¡
    - ë©”ì‹œì§€ ì¬ì‹œë„ ë¡œì§
    - ë°œì†¡ ìƒíƒœ ì¶”ì 

2. ì˜ˆì™¸ ì²˜ë¦¬
    - ì‚¬ìš©ì ì •ì˜ ì˜ˆì™¸ ê³„ì¸µ êµ¬ì¡°
    - ì „ì—­ ì˜ˆì™¸ ì²˜ë¦¬
    - ìƒì„¸ ë¡œê¹…

3. ì„±ëŠ¥ ìµœì í™”
    - Redisë¥¼ í™œìš©í•œ ë©”ì‹œì§€ í êµ¬í˜„
    - ë°°ì¹˜ ì²˜ë¦¬
    - ë¹„ë™ê¸° ë©”ì‹œì§€ ì²˜ë¦¬

## ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°
```mermaid
erDiagram
    MEMBER {
        bigint id PK "í•™ì›ìƒ ID"
        varchar name "í•™ìƒ ì´ë¦„"
        datetime created_at "ìƒì„±ì¼ì‹œ"
        datetime updated_at "ìˆ˜ì •ì¼ì‹œ"
    }

    STUDENT_PARENT {
        bigint id PK "ë¶€ëª¨ ID"
        bigint student_id FK "í•™ìƒ ID"
       varchar name "ë¶€ëª¨ ì´ë¦„"
        datetime created_at "ìƒì„±ì¼ì‹œ"
    }

    ATTENDANCE {
        bigint id PK "ì¶œê²° ID"
        bigint student_id FK "í•™ìƒ ID"
        varchar type "ì¶œê²° íƒ€ì…(ë“±ì›/í•˜ì›)"
        datetime check_time "ì²´í¬ ì‹œê°„"
        datetime created_at "ìƒì„±ì¼ì‹œ"
    }

    DEVICE {
        bigint id PK "ë””ë°”ì´ìŠ¤ ID"
        bigint parent_id FK "ë¶€ëª¨ ID"
        varchar fcm_token "FCM í† í°"
        datetime last_active_at "ë§ˆì§€ë§‰ í™œì„± ì‹œê°„"
        varchar status "ìƒíƒœ"
        datetime created_at "ìƒì„±ì¼ì‹œ"
        datetime updated_at "ìˆ˜ì •ì¼ì‹œ"
    }

    PUSH_MESSAGE {
        bigint id PK "ë©”ì‹œì§€ ID"
        bigint attendance_id FK "ì¶œê²° ID"
        bigint parent_id FK "ë¶€ëª¨ ID"
        varchar title "ì œëª©"
        varchar body "ë‚´ìš©"
        varchar status "ìƒíƒœ"
        int retry_count "ì¬ì‹œë„ íšŸìˆ˜"
        datetime created_at "ìƒì„±ì¼ì‹œ"
    }

    PUSH_HISTORY {
        bigint id PK "ì´ë ¥ ID"
        bigint message_id FK "ë©”ì‹œì§€ ID"
        varchar send_result "ë°œì†¡ ê²°ê³¼"
        datetime sent_at "ë°œì†¡ ì‹œê°„"
    }

    MEMBER ||--o{ STUDENT_PARENT : "ë¶€ëª¨ ì •ë³´"
    MEMBER ||--o{ ATTENDANCE : "ì¶œê²° ê¸°ë¡"
    STUDENT_PARENT ||--o{ DEVICE : "ë””ë°”ì´ìŠ¤ ë³´ìœ "
    ATTENDANCE ||--o{ PUSH_MESSAGE : "ì•Œë¦¼ ë°œìƒ"
    STUDENT_PARENT ||--o{ PUSH_MESSAGE : "ì•Œë¦¼ ìˆ˜ì‹ "
    PUSH_MESSAGE ||--o{ PUSH_HISTORY : "ë°œì†¡ ì´ë ¥"
```